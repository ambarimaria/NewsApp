@model ArticleDetailViewModel
@{
    ViewData["Title"] = Model.Article.Title;
    ViewData["CurrentQuery"] = "";
}

<!-- Breadcrumb -->
<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a asp-controller="News" asp-action="Index" class="text-accent text-decoration-none">Headlines</a>
        </li>
        <li class="breadcrumb-item active text-secondary" style="max-width:400px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">
            @(Model.Article.Title.Length > 60 ? Model.Article.Title[..60] + "…" : Model.Article.Title)
        </li>
    </ol>
</nav>

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger">@Model.ErrorMessage</div>
}

<div class="row g-5">
    <!-- ── Article Main ──────────────────────────────────────────────────── -->
    <div class="col-lg-8">

        <!-- Source & Meta -->
        <div class="d-flex flex-wrap gap-3 align-items-center mb-3">
            <span class="source-badge source-badge-lg">
                @Model.Article.SourceName
            </span>
            @if (Model.Article.PublishedAt.HasValue)
            {
                <span class="text-secondary small">
                    <i class="far fa-calendar me-1"></i>
                    @Model.Article.PublishedAt.Value.ToString("MMMM d, yyyy 'at' h:mm tt")
                </span>
            }
            <span class="text-secondary small">
                <i class="fas fa-user-pen me-1"></i>@Model.Article.DisplayAuthor
            </span>
        </div>

        <!-- Title -->
        <h1 class="article-title mb-4">@Model.Article.Title</h1>

        <!-- Hero Image -->
        @if (Model.Article.HasImage)
        {
            <div class="article-hero-image-wrap mb-4">
                <img src="@Model.Article.ImageUrl"
                     alt="@Model.Article.Title"
                     class="article-hero-image"
                     onerror="this.parentElement.style.display='none'" />
            </div>
        }

        <!-- Description -->
        @if (!string.IsNullOrWhiteSpace(Model.Article.Description))
        {
            <div class="article-lead mb-4">
                <p class="lead text-secondary">@Model.Article.Description</p>
            </div>
        }

        <!-- Content -->
        @if (!string.IsNullOrWhiteSpace(Model.Article.Content))
        {
            <div class="article-body mb-4">
                <p>@Model.Article.Content</p>
            </div>
        }

        <!-- CTA -->
        <div class="article-read-more p-4 rounded-3 border border-accent-subtle text-center">
            <p class="text-secondary mb-3">
                <i class="fas fa-book-open me-2 text-accent"></i>
                Read the full article on <strong>@Model.Article.SourceName</strong>
            </p>
            <a href="@Model.Article.Url"
               target="_blank"
               rel="noopener noreferrer"
               class="btn btn-accent btn-lg">
                <i class="fas fa-arrow-up-right-from-square me-2"></i>
                Read Full Article
            </a>
        </div>

        <!-- Share -->
        <div class="d-flex align-items-center gap-3 mt-4 pt-4 border-top border-secondary-subtle">
            <span class="text-secondary small">Share:</span>
            <a href="https://twitter.com/intent/tweet?url=@Uri.EscapeDataString(Model.Article.Url)&text=@Uri.EscapeDataString(Model.Article.Title)"
               target="_blank" rel="noopener"
               class="btn btn-sm btn-outline-secondary">
                <i class="fab fa-x-twitter me-1"></i> X
            </a>
            <a href="https://www.linkedin.com/sharing/share-offsite/?url=@Uri.EscapeDataString(Model.Article.Url)"
               target="_blank" rel="noopener"
               class="btn btn-sm btn-outline-secondary">
                <i class="fab fa-linkedin me-1"></i> LinkedIn
            </a>
            <button onclick="navigator.clipboard.writeText('@Html.Raw(Model.Article.Url.Replace("'", "\\'"))').then(()=>showToast('Link copied!'))"
                    class="btn btn-sm btn-outline-secondary">
                <i class="fas fa-link me-1"></i> Copy Link
            </button>
        </div>
    </div>

    <!-- ── Sidebar: Related ──────────────────────────────────────────────── -->
    <div class="col-lg-4">
        <div class="sticky-sidebar">
            <h5 class="sidebar-heading mb-3">
                <i class="fas fa-layer-group text-accent me-2"></i>Related Articles
            </h5>

            @if (Model.RelatedArticles.Any())
            {
                <div class="d-flex flex-column gap-3">
                    @foreach (var related in Model.RelatedArticles)
                    {
                        string rUrl  = Uri.EscapeDataString(related.Url);
                        string rTitle = Uri.EscapeDataString(related.Title);
                        string rDesc  = Uri.EscapeDataString(related.Description ?? "");
                        string rImg   = Uri.EscapeDataString(related.ImageUrl ?? "");
                        string rAuth  = Uri.EscapeDataString(related.DisplayAuthor);
                        string rSrc   = Uri.EscapeDataString(related.SourceName);
                        string rDate  = Uri.EscapeDataString(related.PublishedAt?.ToString("o") ?? "");

                        <a href="/News/Detail?url=@rUrl&title=@rTitle&description=@rDesc&image=@rImg&author=@rAuth&source=@rSrc&publishedAt=@rDate"
                           class="related-card text-decoration-none">
                            <div class="d-flex gap-3">
                                @if (related.HasImage)
                                {
                                    <img src="@related.ImageUrl"
                                         alt=""
                                         class="related-thumb flex-shrink-0"
                                         onerror="this.style.display='none'" />
                                }
                                <div class="flex-grow-1 min-width-0">
                                    <p class="related-title text-light mb-1">@related.Title</p>
                                    <span class="text-secondary" style="font-size:.75rem">
                                        @related.SourceName &middot; @related.TimeAgo
                                    </span>
                                </div>
                            </div>
                        </a>
                    }
                </div>
            }
            else
            {
                <p class="text-secondary small">No related articles found.</p>
            }
        </div>
    </div>
</div>

<!-- Toast notification -->
<div id="toastContainer" class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="clipboardToast" class="toast align-items-center text-bg-success border-0" role="alert">
        <div class="d-flex">
            <div class="toast-body" id="toastMessage">Link copied!</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto"
                    data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function showToast(msg) {
            document.getElementById('toastMessage').textContent = msg;
            const toast = new bootstrap.Toast(document.getElementById('clipboardToast'));
            toast.show();
        }
    </script>
}

